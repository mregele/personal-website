---
import PageLayout from "../../layouts/PageLayout.astro";
import BlogPostCard from "../../components/BlogPostCard.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<PageLayout
  title="Blog | Matthew D. Regele"
  description="Blog posts by Matthew D. Regele on entrepreneurship, organizational strategy, higher education, and academic life."
>
  <h1 class="text-3xl sm:text-4xl font-bold text-navy-900 mb-4">Blog</h1>
  <p class="text-slate-600 leading-relaxed mb-10 max-w-2xl">
    Reflections on research in progress, teaching experiments, and broader questions about how
    organizations work and why they sometimes don't.
  </p>

  {posts.length === 0 ? (
    <p class="text-slate-500 italic">No posts yet. Check back soon.</p>
  ) : (
    <div class="space-y-4">
      {posts.map((post) => (
        <BlogPostCard
          title={post.data.title}
          description={post.data.description}
          pubDate={post.data.pubDate.toISOString()}
          slug={post.id}
          tags={post.data.tags}
        />
      ))}
    </div>
  )}

  <!-- Stay Updated -->
  <div class="mt-16 bg-navy-50 border border-navy-100 rounded-xl p-8">
    <h2 class="text-2xl font-bold text-navy-900 mb-2">Stay Updated</h2>
    <p class="text-slate-600 mb-6 max-w-lg">
      Get new posts delivered straight to your inbox. No spamâ€”just new writing when it's ready.
    </p>
    <form action="https://buttondown.com/api/emails/embed-subscribe/mregele" method="post" class="flex flex-col sm:flex-row gap-3 max-w-md">
      <input type="hidden" value="1" name="embed" />
      <input
        type="email"
        name="email"
        placeholder="your@email.com"
        required
        class="flex-1 px-4 py-2 rounded-lg border border-slate-300 bg-white text-slate-800 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-navy-500 text-sm"
      />
      <button
        type="submit"
        class="px-6 py-2 bg-navy-800 text-white text-sm font-semibold rounded-lg hover:bg-navy-700 transition-colors"
      >
        Subscribe
      </button>
    </form>
    <p class="mt-4 text-xs text-slate-500">
      Prefer RSS? <a href="/rss.xml" class="underline hover:text-navy-700 transition-colors">Subscribe via feed.</a>
    </p>
  </div>
</PageLayout>
